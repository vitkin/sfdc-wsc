<project default="usage">
    <property file="wsc.properties"/>
    <property name="version" value="wsc13"/>
    <property name="jdk.root" value="/dev/tools/win32/jdk/jdk1.5.0_06"/>
    <property name="junit.jar" value="/home/mcheenath/dev/tools/ant/apache-ant-1.6.5/lib/junit.jar"/>

    <!-- query -->
    <!-- <property name="query.username" value="manoj1@cheenath.com"/>
    <property name="query.password" value="123456"/>
    <property name="query.endpoint" value="http://localhost/services/Soap/u/8.0"/>
    <property name="query.cols" value="25"/>
    <property name="query.trace" value="false"/>
    -->

    <target name="usage">
        <echo message="Usage: "/>
        <echo message="ant clean   -- delete all generated files"/>
        <echo message="ant build   -- builds both product and tests"/>
        <echo message="ant package -- builds product and package it up"/>
        <echo message="ant run     -- runs the unit tests"/>
        <echo message="ant all     -- cleans, builds and package"/>
    </target>

    <target name="all" depends="clean,build,package"/>

    <target name="clean.product">
        <delete dir="classes"/>
        <antcall target="build.product"/>
        <antcall target="package"/>
    </target>

    <path id="build.classpath">
        <pathelement path="classes"/>
        <pathelement location="lib/js-1.6R2.jar"/>
        <pathelement location="${jdk.root}/lib/tools.jar"/>
        <pathelement path="output/src"/>
    </path>

    <path id="test.classpath">
        <pathelement path="classes"/>
        <pathelement location="lib/js-1.6R2.jar"/>
        <pathelement location="output/enterprise.jar"/>
        <pathelement location="output/partner.jar"/>
        <pathelement location="output/apexSoapTest.jar"/>
        <pathelement location="output/apex.jar"/>
        <pathelement location="output/validateemail.jar"/>
        <pathelement location="output/CensusData.jar"/>
        <pathelement location="output/sun-interop.jar"/>
        <pathelement location="${jdk.root}/lib/tools.jar"/>
        <pathelement location="${junit.jar}"/>
        <pathelement location="../../core/sfdc/java/ext/commons-httpclient-3.0.1.jar"/>
        <pathelement location="../../core/shared/java/ext/commons-logging-1.0.4.jar"/>
    </path>

    <target name="build" depends="build.product,build.test"/>

    <target name="package" depends="dist"/>

    <target name="clean">
        <delete dir="classes"/>
        <delete dir="output"/>
    </target>

    <target name="build.product">
        <mkdir dir="classes"/>
        <mkdir dir="output/src"/>

        <copy file="src/com/sforce/ws/tools/type.template"
              todir="classes/com/sforce/ws/tools/"/>
        <copy file="src/com/sforce/ws/tools/connection.template"
              todir="classes/com/sforce/ws/tools/"/>
        <copy file="src/com/sforce/ws/tools/connector.template"
              todir="classes/com/sforce/ws/tools/"/>
        <copy file="src/com/sforce/ws/tools/sobject.template"
              todir="classes/com/sforce/ws/tools/"/>
        <copy file="src/com/sforce/ws/tools/simpleType.template"
              todir="classes/com/sforce/ws/tools/"/>
        <copy file="src/com/sforce/ws/runtime-classes.txt"
              todir="classes/com/sforce/ws/"/>

        <javac srcdir="src"
               includes="**/*.java"
               destdir="classes"
               deprecation="off"
               debug="on"
               classpathref="build.classpath"
               source="1.5"
                />
    </target>

    <target name="build.test">
        <antcall target="generate"/>

        <javac srcdir="test"
               includes="**/*.java"
               destdir="classes"
               deprecation="off"
               debug="on"
               classpathref="test.classpath"
               source="1.5"
                />
    </target>

    <target name="generate" unless="need.to.generate">
        <delete dir="output"/>
        <mkdir dir="output/src"/>

        <wsdlc name="partner" wsdl="../../core/sfdc-test/func/wsdl/partner.wsdl"/>
        <wsdlc name="enterprise" wsdl="../../core/sfdc-test/func/wsdl/enterprise.wsdl"/>
        <wsdlc name="apex" wsdl="../../core/sfdc-test/func/wsdl/apex.wsdl"/>
        <wsdlc name="apexSoapTest" wsdl="../../core/sfdc-test/func/wsdl/apexSoapTest.wsdl"/>
    </target>

    <target name="all.wsdlc">
        <parallel>
            <wsdlc name="partner-144" wsdl="test/wsdl/partner-144.wsdl"/>
            <wsdlc name="sun-interop" wsdl="test/wsdl/sun-interop.wsdl"/>
            <wsdlc name="CensusData" wsdl="test/wsdl/CensusData.wsdl"/>
            <wsdlc name="validateemail" wsdl="test/wsdl/validateEmail.wsdl"/>

            <wsdlc name="interop-round3" wsdl="test/wsdl/interoptestdoclitparameters.wsdl"/>
            <wsdlc name="enterprise-144" wsdl="enterprise-144.wsdl"/>
            <wsdlc name="enterprise-60" wsdl="../../core/sfdc-test/func/wsdl/enterprise_60.wsdl"/>
            <wsdlc name="enterprise-50" wsdl="../../core/sfdc-test/func/wsdl/enterprise_50.wsdl"/>
            <wsdlc name="ServiceLogin" wsdl="test/wsdl/ServiceLogin.wsdl"/>
            <wsdlc name="BarcodeReader" wsdl="test/wsdl/BarcodeReader.wsdl"/>
            <wsdlc name="AccountService" wsdl="test/wsdl/AccountService.wsdl"/>
            <wsdlc name="AdGroupService" wsdl="test/wsdl/AdGroupService.wsdl"/>
            <wsdlc name="CampaignService" wsdl="test/wsdl/CampaignService.wsdl"/>
            <wsdlc name="CreativeService" wsdl="test/wsdl/CreativeService.wsdl"/>
            <wsdlc name="CriterionService" wsdl="test/wsdl/CriterionService.wsdl"/>
            <wsdlc name="InfoService" wsdl="test/wsdl/InfoService.wsdl"/>
            <wsdlc name="KeywordToolService" wsdl="test/wsdl/KeywordToolService.wsdl"/>
            <wsdlc name="TrafficEstimatorService" wsdl="test/wsdl/TrafficEstimatorService.wsdl"/>
            <wsdlc name="partner-142" wsdl="test/wsdl/partner-142.wsdl"/>
            <wsdlc name="enterprise-142" wsdl="test/wsdl/enterprise-142.wsdl"/>
        </parallel>
    </target>

    <macrodef name="wsdlc">
        <attribute name="name"/>
        <attribute name="wsdl"/>
        <sequential>
            <echo message="----------------------"/>
            <delete file="output/@{name}.jar"/>
            <echo message="compiling **@{name}** wsdl"/>
            <java classname="com.sforce.ws.tools.wsdlc"
                  classpathref="build.classpath" fork="true"
                  failonerror="true">
                <arg line="@{wsdl}"/>
                <arg line="output/@{name}.jar"/>
            </java>
        </sequential>
    </macrodef>

    <target name="dist">

        <antcall target="dist.jar"/>

        <delete file="dist/${version}.zip"/>

        <zip destfile="dist/wsc/src.zip">
            <fileset dir="src"/>
            <fileset dir="test"/>
        </zip>

        <zip destfile="dist/${version}.zip"
             basedir="dist"
             includes="wsc/**">
        </zip>
    </target>

    <target name="dist.jar">

        <delete dir="dist/wsc/lib"/>

        <mkdir dir="dist/wsc/lib/temp"/>
        <mkdir dir="dist/wsc/doc/javadoc"/>

        <unjar src="lib/js-1.6R2.jar" dest="dist/wsc/lib/temp"/>

        <copy todir="dist/wsc/lib/temp">
            <fileset dir="classes"/>
        </copy>

        <copy todir="dist/wsc/lib/temp">
            <fileset dir="src"/>
        </copy>

        <copy todir="dist/wsc/lib">
            <fileset dir="output">
                <include name="*.jar"/>
            </fileset>
        </copy>

        <jar destfile="dist/wsc/lib/wsc.jar"
             basedir="dist/wsc/lib/temp">
            <manifest>
                <attribute name="Built-By" value="wsc"/>
                <attribute name="Main-Class" value="com.sforce.ws.tools.wsdlc"/>
            </manifest>
        </jar>

        <delete dir="dist/wsc/lib/temp"/>

    </target>

    <target name="package.javadoc">
        <delete dir="dist/wsc/doc/javadoc"/>
        <mkdir dir="dist/wsc/doc/javadoc/runtime"/>
        <mkdir dir="dist/wsc/doc/javadoc/enterprise"/>
        <mkdir dir="dist/wsc/doc/javadoc/partner"/>

        <javadoc destdir="dist/wsc/doc/javadoc/runtime"
                 author="true"
                 version="true"
                 use="true"
                 sourcepath="src"
                 overview="src/overview.html"
                 windowtitle="Salesforce Web Service Connector ${version}"
                 linksource="true"
                 verbose="off"
                 package="true">

            <fileset dir="src" defaultexcludes="yes">
            </fileset>
        </javadoc>
    </target>

    <target name="run">
        <java classname="com.sforce.ws.Main"
              classpathref="test.classpath" fork="true"
              dir="test"/>
    </target>

    <target name="update.main">
        <p4edit view="../../core/shared/java/ext/wsc.jar"/>
        <copy file="dist/wsc/lib/wsc.jar" todir="../../core/shared/java/ext"/>
    </target>

</project>
